<html>
    <head>
        <script
            type="text/javascript"
            src="../../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
* Encodes and saves an article into the 
* appropriate location. Just a basic script,
* nothing too fancy.
*
* @since 06/05/2013
*/
$postpath = $_POST['postpath'];

if ( $_POST['file'] == '' ){
	$nodeDate = date(&quot;Y.m.d&quot;);
	$nodename = $nodeDate.'.0';
	$postFname = $nodename.'.json';

	$i = 0;
	while ( file_exists( $postpath.'/'.$postFname ) ){
		$i++;
		$nodename = $nodeDate.'.'.$i;
		$postFname = $nodename.'.json';

	}
}

else{
	$postFname = $_POST['file'];
	$nodename = substr($postFname, 0, strpos($postFname, '.json') );
}


$postData = array();

$postData['content'] = $_POST['content'];
$postData['title'] = $_POST['title'];
$postData['date'] = $_POST['date'];
$postData['tags'] = $_POST['tags'];
$postData['datestamp'] = date(DATE_ATOM);
$postData['updated'] = date(DATE_ATOM);

$postJsonData = json_encode($postData);
$postFile = $postpath.'/'.$postFname;

$lock = new lock( $postFile );

$postURL = getConfigOption('site_domain').'/'.$_POST['blog'].'/index.php?id=post&amp;node='.$nodename;
$writetest = fopen( $postpath.'/writetest.txt', 'w' );
fclose( $writetest );

if ( is_writeable( $postpath.'/writetest.txt' ) &amp;&amp; !$lock-&gt;isLocked() ){

	$lock-&gt;lock();

	$jsonFile = fopen($postpath.'/'.$postFname, 'w');
	fwrite($jsonFile, $postJsonData);
	fclose($jsonFile);

	$lock-&gt;unlock();

	unlink( $postpath.'/writetest.txt');

	print '&lt;h1&gt;Post Saved&lt;/h1&gt;';
	print '&lt;p&gt;View this post at &lt;a href=&quot;'.$postURL.'&quot;&gt;'.$postURL.'&lt;/a&gt;&lt;/p&gt;';
}
else{
	print '&lt;h1&gt;Post could not be saved&lt;/h1&gt;';
	print '&lt;p&gt;The post could not be saved, likely because Gnat does not have write access to the location. 
	Your post is displayed below as entered so that you can copy and paste it elsewhere until the problem gets fixed.&lt;/p&gt;
	&lt;hr /&gt;';
	print '&lt;h1&gt;'.htmlspecialchars( $_POST['title'] ).'&lt;/h1&gt;';
	print '&lt;p&gt;'.htmlspecialchars( $_POST['date'] ).'&lt;/p&gt;';
	print '&lt;p&gt;'.htmlspecialchars( $_POST['tags'] ).'&lt;/p&gt;';
	print '&lt;p&gt;'.htmlspecialchars( $_POST['content'] ).'&lt;/p&gt;';
}



?&gt;
&lt;p&gt;&lt;a href=&quot;&lt;?php print getConfigOption('site_domain'); ?&gt;/webadmin&quot;&gt;Back to webadmin panel&lt;/a&gt;&lt;/p&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>