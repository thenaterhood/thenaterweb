<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/*
 * Author: Nate Levesque &lt;public@thenaterhood.com&gt;
 * Language: PHP
 * Filename: tags
 * 
 * Description:
 * 	Manages retrieving tags and posts via tags.  Is not intented
 * 	to be called standalone and should be included in another file
 * 	that already has established config and session instances.
 */
include_once GNAT_ROOT.'/lib/core_histogram.php';

$tag = $session-&gt;tag;
$inventory = new inventory( $blogdef-&gt;post_directory );


if ( $tag ){
	/*
	 * If a tag was requested, display which tag is being browsed
	 * with a link back to the main page of tags
	 */
    print '&lt;p&gt;&lt;strong&gt;Browsing tag &quot;'.$tag.'&quot;.  &lt;/strong&gt;&lt;a href=&quot;/?url='.$blogdef-&gt;id.'/taghistogram&quot;&gt;View all tags.&lt;/a&gt;&lt;/p&gt;'.&quot;\n&quot;;

}

if ( !$tag ){
    /*
     * Check if a tag was requested, otherwise list the available
     * tags.
     */
    echo &quot;&lt;table&gt;&quot;;

    $tags = $inventory-&gt;getFieldStatistics( 'tags' );
    ksort($tags);
    $histogram = generateHistogramNospace( $tags, &quot;&amp;#9646;&quot; );
    $letter = &quot;&quot;;
    foreach( $histogram as $item =&gt; $graph ){
        if ( substr($item, 0, 1) != $letter ){
            $letter = substr($item, 0, 1);
            print '&lt;tr&gt;&lt;td&gt;&lt;a id=&quot;alph_'.$letter.'&quot;&gt;&lt;/a&gt;&lt;strong&gt;'.$letter.'&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;'.&quot;\n&quot;;
        }
        $clean = str_replace( &quot; &quot;, '%20', $item);
        echo '&lt;tr&gt;&lt;td&gt;&lt;a href=&quot;/?url='.$blogdef-&gt;id.'/tags/tag/'.$clean.'&quot;&gt;'.$item.'&lt;/a&gt;&lt;/td&gt;';
        echo '&lt;td&gt;'.$graph.'&lt;em&gt; '.$tags[$item].' posts&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;'.&quot;\n&quot;;
    }

    echo &quot;&lt;/table&gt;&quot;;

}
else{
    echo &quot;&lt;ul&gt;&quot;;
    /*
     * If a tag was requested, call getByTag to print all posts
     * with the tag.
     */
    $matching = $inventory-&gt;select( 'tags', $tag );

    foreach ($matching as $item) {
        print '&lt;li&gt;&lt;a href=&quot;'.htmlentities( $item['link'] ).'&quot;&gt;'.$item['title'].'&lt;/a&gt;&lt;/li&gt;';
    }

    echo &quot;&lt;/ul&gt;&quot;;

}


?&gt;
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>