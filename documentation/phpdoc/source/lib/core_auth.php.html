<html>
    <head>
        <script
            type="text/javascript"
            src="../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php 

if( !($passwd = @fopen( &quot;./.htpasswd&quot;, &quot;r&quot; ))) {  
	 echo &quot;Cannot open password file.&quot;; 
	 exit; 
} 

if (!isset($_SERVER['PHP_AUTH_USER'])) {  
	Header( &quot;WWW-authenticate: basic realm=\&quot;Realm\&quot;&quot; ); 
	Header( &quot;HTTP/1.0 401 Unauthorized&quot; ); 
	echo &quot;Text to see if user hits 'Cancel'&quot;; 
	exit; 
} 

while( $pwent = fgets( $passwd, 100 )) {

	$part = explode( &quot;:&quot;, chop($pwent));
	$pass = explode( &quot;\$&quot;, $part[1]);

	$plainpasswd=$_SERVER['PHP_AUTH_PW'];
	$salt=$pass[2];
	$len = strlen($plainpasswd);
	$text = $plainpasswd.'$apr1$'.$salt;
	$bin = pack(&quot;H32&quot;, md5($plainpasswd.$salt.$plainpasswd));
	for($i = $len; $i &gt; 0; $i -= 16) { 
        $text .= substr($bin, 0, min(16, $i)); 
    }
	for($i = $len; $i &gt; 0; $i &gt;&gt;= 1) { 
        $text .= ($i &amp; 1) ? chr(0) : $plainpasswd{0}; 
    }
	$bin = pack(&quot;H32&quot;, md5($text));
	for($i = 0; $i &lt; 1000; $i++) {
		 $new = ($i &amp; 1) ? $plainpasswd : $bin;
		 if ($i % 3) $new .= $salt;
		 if ($i % 7) $new .= $plainpasswd;
		 $new .= ($i &amp; 1) ? $bin : $plainpasswd;
		 $bin = pack(&quot;H32&quot;, md5($new));
	}
	$tmp=&quot;&quot;;
	for ($i = 0; $i &lt; 5; $i++) {
		 $k = $i + 6;
		 $j = $i + 12;
		 if ($j == 16) $j = 5;
		 $tmp = $bin[$i].$bin[$k].$bin[$j].$tmp;
	}
	$tmp = chr(0).chr(0).$bin[11].$tmp;
	$tmp = strtr(strrev(substr(base64_encode($tmp), 2)),
	   &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;,
	   &quot;./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;);
	$hashedpasswd = &quot;$&quot;.&quot;apr1&quot;.&quot;$&quot;.$salt.&quot;$&quot;.$tmp;

	if (($_SERVER['PHP_AUTH_USER'] == $part[0]) &amp;&amp; ($hashedpasswd == $part[1])){
		#echo &quot;Now you are Logged In&quot;;
		#exit;
	} else{
        Header( &quot;WWW-authenticate: basic realm=\&quot;Realm\&quot;&quot; ); 
        Header( &quot;HTTP/1.0 401 Unauthorized&quot; ); 
    }

}

// This only has effect of no text was output previously, so 
//  it is ignored in all cases except authentication error. 
?&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>