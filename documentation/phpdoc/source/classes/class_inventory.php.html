<html>
    <head>
        <script
            type="text/javascript"
            src="../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Provides a self-sufficient file with the inventory
 * class, which abstracts access to a data file containing
 * an index of posts or articles in a directory.
 */

/**
 * Includes the necessary facilities for managing
 * the inventory
 */
include_once GNAT_ROOT.'/lib/core_web.php';
include_once GNAT_ROOT.'/classes/class_article.php';
include_once GNAT_ROOT.'/classes/class_directoryIndex.php';
include_once GNAT_ROOT.'/classes/class_urlset.php';

/**
 * Provides a database-like means of accessing an inventory
 * of posts or articles in a directory for efficiently searching
 * for things by certain criteria, as well as maintaining
 * and updating the data. Stored in json format currently, but
 * due to being abstracted out, could be modified to store
 * the data in other formats.
 *
 * @since 5/13/2013
 * @author Nate Levesque &lt;public@thenaterhood.com&gt;
 */
class inventory extends directoryIndex{


	public function __construct( $directory, $bloguri=NULL ){

		parent::__construct( $directory, $bloguri, &quot;inventory&quot; );

	}


	public function update(){

		$this-&gt;metadata['updated'] = date(DATE_ATOM);

		parent::update( &quot;getMeta&quot; );

	}

	/**
	 * Regenerates the blog inventory file
	 */
	public function regen(){

		$dbCols = array();
		$dbCols['tags'] = 'Text';
		$dbCols['nodeid'] = 'Text';
		$dbCols['title'] = 'Text';
		$dbCols['link'] = 'Text';
		$dbCols['datestamp'] = 'Text';
		$dbCols['author'] = 'Text';
		$dbCols['file'] = 'Text';

		$this-&gt;db-&gt;dropTable( 'main' );
		$this-&gt;db-&gt;createTable( 'main', $dbCols );

		$metadata = array();
		$metadata['sitemap'] = getConfigOption('site_domain').'/?url='.$this-&gt;bloguri.'/titles';
		$metadata['updated'] = date(DATE_ATOM);
		parent::regen( &quot;getMeta&quot;, $metadata );

	}

	/**
	 * Returns all the inventory items that match a
	 * requested value in the requested field
	 *
	 * @param $field - the field to search in
	 * @param $value - the value to search for
	 *
	 * @return $matching - all the matching items in the inventory
	 */
	public function select( $field, $value ){

		return $this-&gt;db-&gt;selectSome( $field, $value, 'main' );

	}

	/**
	 * Returns a histogram of values mapped to 
	 * their occurances for the selected field
	 *
	 * @param $field - the name of the field to access
	 * @since 7/20/13
	 */
	public function getFieldStatistics( $field ){

		$fieldContents = array();

		foreach ($this-&gt;selectField( $field ) as $current ) {

			if ( ! is_array( $current ) ){
				$currentField = explode( ', ', $current );
			}
			else{
				$currentField = $current;
			}

			foreach ($currentField as $item) {
				if ( ! array_key_exists( $item, $fieldContents) )
					$fieldContents[$item] = 1;
				else
					$fieldContents[$item] = $fieldContents[$item] + 1;
			}

		}

		return $fieldContents;

	}

	/**
	 * Returns an array containing the data from a 
	 * particular field, with repeats filtered out
	 *
	 * @param $field - the name of the field to access
	 */
	public function selectField( $field ){

        $fieldContents = array();
        $fieldData = $this-&gt;db-&gt;selectColumn( $field, 'main' );                         
        foreach( $fieldData as $index =&gt; $current) {
                if ( ! is_array( $current ) ){
                                                                                        
                        $currentField = explode( ', ', $current );
                } else {                                                                
                        $currentField = $current;
                }
                foreach ( $currentField as $item ) {                                    
                        $fieldContents[] = $item;
                }       
        }       
        return $fieldContents; 


		#return array_unique( $this-&gt;db-&gt;query( 'SELECT '. $field . ' FROM main', array() ) );

	}

	/**
	 * Returns all the fields in the inventory
	 */
	public function selectAll(){
		return $this-&gt;db-&gt;selectTable( 'main' );
	}
	/**
	 * A function to return the inventory file. For supporting
	 * legacy functions
	 */
	public function getFile(){
		return $this-&gt;inventoryFile;
	}

}

?&gt;
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>